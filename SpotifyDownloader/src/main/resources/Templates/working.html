<html>

<head>
    <meta charset="utf-8" />
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css" />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>Youdownloadify</title>
    <style>
        body {
            background-color: #8bc34a;
        }
        
        .white-text {
            color: aliceblue;
        }
        
        .backgroud-white {
            background-color: aliceblue;
        }
        
        .black-text {
            color: black;
        }
        
        .center-text {
            text-align: center;
            align-content: center;
        }
    </style>
</head>

<body>
    <div class="row">

        <div class="col s1"></div>
        <div class="col s10">
            <div class="valign-wrapper">
                <div class="card-panel teal" style="width:100%; ">
                    <h1 class="center-text"><strong>YouDownloadify</strong></h1>
                    <div>
                        <h3 id="stage" class="center-text">Buscando Canciones en Spotify</h3>
                        
                        <div id="preDownloadSpin" class="center-text">

                            <div class="progress">
                                <div class="indeterminate yellow"></div>
                            </div>

                        </div>
                        <div id="divProgress" style="display:none;">
                            <span class="new badge green" data-badge-caption="Progreso"></span>
                            <div class="progress">
                                <div id="processBar" class="determinate lime accent-3" style="width: 1%"></div>
                            </div>
                        </div>
                        <div id="buttonBack" class="center-text" style="display:none;">
                            <a class="waves-effect waves-light btn light-green" href="/">Volver</a>
                        </div>
                        <div id="stageDescargando" style="display:none;">
                            <ul class="collection with-header">
                                <li class="collection-header">
                                    <h4>Canciones descargandose</h4></li>
                                <li class="collection-item" id="collectionDescargandose">

                                </li>

                            </ul>
                        </div>
                        <ul class="collapsible backgroud-white" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header">Log info</div>
                                <div class="collapsible-body">
                                    <ul class="collection with-header" id="infoLog">

                                    </ul>


                                </div>
                            </li>
                        </ul>
                        <br/>
                        <div class="center-text white-text">Copyright (C) 2016-2017 Victor Reiner & Gonzalo Ruanes</div>
                    </div>


                </div>
            </div>




        </div>
        <div class="col s1"></div>
    </div>

</body>
<script>
    var intervale;
    $(document).ready(function () {
        $('.collapsible').collapsible();
        intervale = setInterval(function () {
            checkStatus();
        }, 500);
    });

    function checkStatus() {
        var dataGet = {};
        $.ajax({
            url: '/getstatus',
            data: dataGet,
            type: 'GET',
            dataType: "json",
            success: function (result) {
                var info = $('#idInfo').html();
                var stage = result.stage;
                if (stage == "Spotify") {
                    $('#stage').html("Buscando Canciones en Spotify");
                }
                if (stage == "Youtube") {
                    $('#stage').html("Buscando Canciones en Youtube");
                }
                if (stage == "Download") {
                    $('#preDownloadSpin').slideUp();
                    $('#divProgress').slideDown();
                    $('#collectionDescargandose').slideDown();
                    $('#stage').html("Descargando Canciones");
                    $('#stageDescargando').slideDown();
                    var downloading = result.downloads;
                    $('#collectionDescargandose').html('');
                    for (var i = 0, l = downloading.length; i < l; i++) {
                        var aux = '<div>' + downloading[i] + '<a href="#!" class="secondary-content"><i class="material-icons">play_for_work</i></a></div>';
                        $('#collectionDescargandose').append(aux);

                    }
                    var aux = ((result.downloaded / result.total) * 100);
                    var percentage = aux + "%";
                    $('#processBar').width(percentage);
                }

                if (stage == "End") {
                    console.log("end");
                    $('#stage').html("Descargas finalizadas");
                    $('#stageDescargando').slideUp();
                    $('#buttonBack').slideDown();
                    clearInterval(intervale);
                    $('#processBar').width('100%');

                }
                var messages = result.messages;
                for (var i = 0, l = messages.length; i < l; i++) {
                    var aux = '<li class="collection-header">' + messages[i] + '</li>';
                    $('#infoLog').append(aux);
                }





            },
            error: function (xhr, status) {
                console.log(xhr);
                console.log(status);

            }
        });
    };
</script>

</html>